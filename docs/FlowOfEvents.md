# Поток событий

## Подключение к платформе

Данный вариант использования позволяет внешнему интерфейсу подключаться к платформе для дальнейшего управления ей  
Предусловие: платформа находится в состоянии ожидания подключения  
Основной поток событий:  
1. Вариант использования начинается, когда платформа переходит в состояние ожидания подключения  
2. Платформа ожидает прихода сообщения по любому из внешних интерфейсов
2. Платформа проверяет, является ли пришедшее сообщение неповрежденной командой подключения. Если нет, выполняется альтернативный поток E1.
2. Платформа возвращает [утвердительный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено это сообщение.
2. Платформа переходит в состояние ожидания следующей команды
3. Вариант использования завершается

Альтернативный поток событий E1:
1. Платформа возвращает [отрицательный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено это сообщение.
3. Вариант использования начинается сначала

## Отключение от платформы

Данный вариант использования позволяет внешнему интерфейсу принудительно отключаться от платформы  
Предусловие: платформа находится в состоянии ожидания команды  
Основной поток событий:  
1. Вариант использования начинается, когда была принята и распознана команда отключения от платформы  
2. Платформа возвращает [утвердительный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено это сообщение.
2. Платформа переходит в состояние ожидания подключения
3. Вариант использования завершается

## Управление движением

Данный вариант использования позволяет внешнему интерфейсу управлять движением платформы через драйвер двигателя.  
Предусловие: платформа находится в состоянии ожидания команды  
Основной поток событий:  
1. Вариант использования начинается, когда была принята и распознана команда управления движением  
2. Платформа проверяет корректность параметров в команде. При обнаружении некорректных параметров выполняется альтернативный поток E2.
3. Платформа конвертирует параметры команды в вид, принимаемый драйвером двигателя
3. Платформа отправляет данные драйверу двигателя
2. Платформа возвращает [утвердительный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено это сообщение.
5. Вариант использования завершается

Альтернативный поток событий E2:
1. Платформа возвращает [отрицательный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено сообщение.
5. Вариант использования завершается

Постусловия: 
Платформа переходит в состояние ожидания следующей команды

<a name="servo_manage"/>

## Управление поворотной платформой
//TODO
Данный вариант использования позволяет внешнему интерфейсу устанавливать угол отклонения поворотной платформы от начального положения.  
Предусловие: платформа находится в состоянии ожидания команды  
Основной поток событий:  
1. Вариант использования начинается, когда была принята и распознана команда работы с сервоприводами  
2. Платформа проверяет корректность параметров в команде. При обнаружении некорректных параметров выполняется альтернативный поток E2.
3. Платформа проверяет вид команды: получение информации о текущем положении поворотной платформы или изменение текущего положения сервоприводов в пространстве. В первом случае выполняется поток событий ["Получение информации о текущем положении поворотной платформы"](#servo_get_info) и текущий поток завершается
3. Платформа конвертирует параметры команды в вид, требуемый поворотной платформе для установки текущего отклонения  
4. Платформа отправляет данные о требуемом положении сервоприводам  
4. Платформа возвращает [утвердительный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено это сообщение.
5. Вариант использования завершается

Альтернативный поток событий E2:
1. Платформа возвращает [отрицательный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено сообщение.
5. Вариант использования завершается

Постусловия: 
Платформа переходит в состояние ожидания следующей команды

<a name="servo_get_info"/>

## Получение информации о текущем положении поворотной платформы
//TODO
Данный вариант использования позволяет внешнему интерфейсу получать информацию о текущем положении поворотной платформы.  
Предусловие: платформа находится в состоянии ожидания команды  
Основной поток событий:  
1. Вариант использования начинается, когда была принята и распознана команда работы с сервоприводами  
2. Платформа проверяет корректность параметров в команде. При обнаружении некорректных параметров выполняется альтернативный поток E2.
3. Платформа проверяет вид команды: получение информации о текущем положении поворотной платформы или изменение текущего положения сервоприводов в пространстве. В последнем случае выполняется поток событий ["Управление поворотной платформой"](#servo_manage) и текущий поток завершается
3. Платформа получает информацию о текущем положении поворотной платформы  
3. Платформа конвертирует полученную информацию в соответствии с протоколом общения с вненшими интерфейсами
4. Платформа возвращает сконвертированную информацию внешнему интерфейсу
4. Платформа возвращает [утвердительный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено это сообщение.
5. Вариант использования завершается

Альтернативный поток событий E2:
1. Платформа возвращает [отрицательный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено сообщение.
5. Вариант использования завершается

Постусловия: 
Платформа переходит в состояние ожидания следующей команды

## Получение информации с датчиков линии

Данный вариант использования позволяет внешнему интерфейсу получать информацию с датчиков линии платформы.  
Предусловие: платформа находится в состоянии ожидания команды  
Основной поток событий:  
1. Вариант использования начинается, когда была принята и распознана команда получения информации с датчиков линии  
2. Платформа проверяет корректность параметров в команде. При обнаружении некорректных параметров выполняется альтернативный поток E2.
3. Платформа конвертирует параметры команды в вид, принимаемый переходной платой датчиков линии 
3. Платформа отправляет данные переходной плате датчиков линии 
3. Платформа получает информацию с переходной платы датчиков линии
3. Платформа конвертирует информацию с переходной платы датчиков линии в соответствии с протоколом общения с вненшими интерфейсами: 0 - под датчиком светлая область, 1 - под датчиком темная область
4. Платформа возвращает сконвертированную информацию внешнему интерфейсу
4. Платформа возвращает [утвердительный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено это сообщение.
5. Вариант использования завершается

Альтернативный поток событий E2:
1. Платформа возвращает [отрицательный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено сообщение.
5. Вариант использования завершается

Постусловия: 
Платформа переходит в состояние ожидания следующей команды

## Получение информации с датчиков расстояния

Данный вариант использования позволяет внешнему интерфейсу получать информацию с датчиков расстояния платформы.  
Предусловие: платформа находится в состоянии ожидания команды  
Основной поток событий:  
1. Вариант использования начинается, когда была принята и распознана команда получения информации с датчиков расстояния  
2. Платформа проверяет корректность параметров в команде. При обнаружении некорректных параметров выполняется альтернативный поток E2.
3. Платформа конвертирует параметры команды в вид, принимаемый переходной платой датчиков расстояния 
3. Платформа отправляет данные переходной плате датчиков расстояния 
3. Платформа получает информацию с переходной платы датчиков расстояния
3. Платформа конвертирует информацию с переходной платы датчиков расстояния в общепринятые единицы измерения расстояния (сантиметры)
4. Платформа возвращает сконвертированную информацию внешнему интерфейсу
4. Платформа возвращает [утвердительный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено это сообщение.
5. Вариант использования завершается

Альтернативный поток событий E2:
1. Платформа возвращает [отрицательный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено сообщение.
5. Вариант использования завершается

Постусловия: 
Платформа переходит в состояние ожидания следующей команды

## Обработка поврежденных и неподдерживаемых команд

Данный вариант использования позволяет внешнему интерфейсу получать сообщения и выделять полезную информацию  
Предусловие: платформа находится в состояниях ожидания команды или подключения  
Основной поток событий:  
1. Вариант использования начинается, когда была принято сообщение
2. Платформа проверяет, является ли принятое сообщение командой. Если нет, выполняется альтернативный поток E2.
2. Платформа проверяет, повреждена ли принятая команда. Если да, выполняется альтернативный поток E2.
3. Платформа проверяет, поддерживается ли данная команда и распознает ее тип. Если нет, выполняется альтернативный поток E2.
4. Платформа возвращает [утвердительный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено это сообщение.
3. Платформа отправляет команду на выполнение.
5. Вариант использования завершается

Альтернативный поток событий E2:
1. Платформа возвращает [отрицательный ответ](Requirements.md#service_answers) используя внешний интерфейс, от которого было получено сообщение.
5. Вариант использования завершается
